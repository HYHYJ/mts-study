# 6.3 타입 좁히기

- [6. 고급 타입](#6고급-타입)
  - [6.3 타입 좁히기?](#63-타입좁히기)
- [타입 좁히기 ?](#타입좁히기-)
  - [등가 연산자를 이용한 좁히기](#등가-연산자를-이용한-좁히기)
  - [typeof 연산자를 이용한 좁히기](#typeof-연산자를-이용한-좁히기)
  - [대수적 데이터 타입을 유니온 타입으로 재현하는 태크닉](#대수적-데이터-타입을-유니온-타입으로-재현하는-태크닉)
  - [switch문으로도 타입을 좁힐 수 있다](#switch문으로도-타입을-좁힐-수-있다)

### 6.3 타입 좁히기?

#### 등가 연산자를 이용한 좁히기
```ts
type SignType = "plus" | "minus";
function signNumber(type: SignType) {
  return type === "plus" ? 1 : -1;
}

function numberWithSign(num: number, type: SignType | "none") {
  if (type === "none") {
    // 여기에서 type은 "none" 타입
    return 0;
  } else {
    // 여기에서 type은 SignType 타입
    return num * signNumber(type);
  }
}

console.log(numberWithSign(5, "plus"));  // 5라고 출력된다
console.log(numberWithSign(5, "minus")); // -5라고 출력된다
console.log(numberWithSign(5, "none"));  // 0이라고 출력된다

```
```ts
function numberWithSign2(num: number, type: SignType | "none") {
  if (type === "none") {
    // 여기에서 type은 "none" 타입
    return 0;
  }

  // 여기에서 type은 SignType 타입
  return num * signNumber(type);
}

function numberWithSign3(num: number, type: SignType | "none") {
  return type === "none" ? 0 : num * signNumber(type);
}

console.log(numberWithSign2(5, "minus")); // -5라고 출력된다
console.log(numberWithSign3(3, "plus")); // 3이라고 출력된다

```
#### typeof 연산자를 이용한 좁히기
```ts
console.log(typeof "uhyo"); // "string"이라고 출력된다
console.log(typeof 26); // "number"라고 출력된다
console.log(typeof {}); // "object"라고 출력된다
console.log(typeof undefined); // "undefined"라고 출력된다
```
```ts
function formatNumberOrString(value: string | number) {
  if (typeof value === "number") {
    return value.toFixed(3);
  } else {
    return value;
  }
}

console.log(formatNumberOrString(3.14));   // "3.140"이라고 출력된다
console.log(formatNumberOrString("uhyo")); // "uhyo"라고 출력된다
```
#### 대수적 데이터 타입을 유니온 타입으로 재현하는 태크닉
```ts
type Animal = {
  tag: "animal";
  species: string;
}
type Human = {
  tag: "human";
  name: string;
}
type User = Animal | Human;
```
```ts
const tama: User = {
  tag: "animal",
  species: "Felis silvestris catus"
};
const uhyo: User = {
  tag: "human",
  name: "uhyo",
};

// 이 객체는 대입할 수 없다
const alien: User = {
  // 에러: Type '"alien"' is not assignable to type '"animal" | "human"'.
  tag: "alien",
  name: "gray"
};
```
```ts
function getUserName(user: User) {
  if (user.tag === "human") {
    // 여기에서 user는 Human 타입
    return user.name;
  } else {
    // 여기에서 user는 Animal 타입
    return "이름 없음";
  }
}

const nabi: User = {
  tag: "animal",
  species: "Felis silvestris catus"
};
const uhyo: User = {
  tag: "human",
  name: "uhyo",
};

console.log(getUserName(nabi)); // "이름 없음"이라고 출력된다
console.log(getUserName(uhyo)); // "uhyo"라고 출력된다
```
#### switch문으로도 타입을 좁힐 수 있다
```ts
type Animal = {
  tag: "animal";
  species: string;
}
type Human = {
  tag: "human";
  name: string;
}
type User = Animal | Human;

function getUserName(user: User): string {
  switch (user.tag) {
    case "human":
      return user.name;
    case "animal":
      return "이름 없음";
  }
}
```
```ts
type Animal = {
  tag: "animal";
  species: string;
}
type Human = {
  tag: "human";
  name: string;
}
type Robot = {
  tag: "robot";
  name: string;
}
type User = Animal | Human | Robot;

function getUserName1(user: User): string {
  if (user.tag === "human") {
    return user.name;
  } else {
    return "이름 없음";
  }
}
// 에러: Function lacks ending return statement and return type does not include 'undefined'.
function getUserName2(user: User): string {
  switch (user.tag) {
    case "human":
      return user.name;
    case "animal":
      return "이름 없음";
  }
}
```
```ts
function getUserName2(user: User): string {
  switch (user.tag) {
    case "human":
      return user.name;
    case "animal":
      return "이름 없음";
    case "robot":
      return `CPU ${user.name}`;
  }
}
```